<html lang="fr-FR";>
<head>
<meta  charset=UTF-8">
</head>
<body>
<div id="chart-container">
<p id="AffichageAlarm" style="text-align:left; color:#040457;"></p>
<style type="text/css">
{ background-color: white; height: 100%; margin: 0; padding: 0;}
a { text-decoration:none;}
#chart-container { width: 180px; height: 180px; display: block; position:absolute; bottom:0; top:0; left:0; right:0; margin: 5px 15px 15px 0; overflow: hidden; }
</style>

<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js'></script>

<script type="text/javascript">

//=============================== TitreMoulinsart =================================//
var site = "arthur";
var room = "Moulinsart";
var channel_id = 809574;
var api_key = '2WTHUAZL6YMI175Y';

//================================================================================//


var TexteTitre = "<a target=\"_top\" href=\"https://am-jl.jimdo.com/";
var TexteTitre1 = "/\">";
var TexteTitre2 = "</a><span style=\"font-size:0.8em; font-family: Arial, Helvetica, sans-serif;\" >";
var TexteTitre3 = ":";
var TexteTitre4 = "<br>";
var TexteTitre5 = "</span></p>";

var date_last_update;

var MinutesTemp;

var MinutesWorking;

// user's timezone offset
var my_offset = new Date().getTimezoneOffset();

var data;

$.getJSON( 'https://api.thingspeak.com/channels/' + channel_id + '/fields/1.json?api_key=' + api_key, function(data) {
	TexteTitre += site;
	TexteTitre += TexteTitre1;
	//	TexteTitre += room;
	TexteTitre += TexteTitre2;
	
	
	
	// iterate through each feed
	$.each(data.feeds, function() 
	{
		
		
//		date_last_update = new Date(data.created_at);
		date_last_update = new Date(this.created_at);


		var options = { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric' };
		TexteTitre += date_last_update.toLocaleDateString('fr-FR',options);
		TexteTitre += " ";  
		TexteTitre += date_last_update.getHours();
		TexteTitre += TexteTitre3;
		MinutesWorking = date_last_update.getMinutes();
		if (MinutesWorking < 10) {MinutesTemp = '0'; MinutesTemp += MinutesWorking;}
		else {MinutesTemp = MinutesWorking;}
		TexteTitre += MinutesTemp;
		TexteTitre += TexteTitre4;
		TexteTitre += this["field1"];
		TexteTitre += TexteTitre4;

		
	} )
	
	TexteTitre += TexteTitre5;	
	document.getElementById("AffichageAlarm").innerHTML = TexteTitre;

	
}	);

// converts date format from JSON
function getChartDate(d) 
{
	// offset in minutes is converted to milliseconds and subtracted so that chart's x-axis is correct
	return Date.parse(d) - (my_offset * 60000);
}


</script>
</div>
</body>
</html>