<!DOCTYPE html>
<html>
<head>
	<meta  charset=UTF-8"> <meta http-equiv="refresh" content="150">
</head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<body>

<div id="chart-container">
<p id="AffichageTitre" style="text-align:center; font-family:\"Noto Sans\",HelveticaNeue-Light,\"Helvetica Neue Light\",\"Helvetica Neue\",Helvetica,Arial,\"Lucida Grande\",sans-serif;"></p>
</div>
<style type="text/css">
{ background-color: white; height: 100%; font-family:"Noto Sans",HelveticaNeue-Light,"Helvetica Neue Light","Helvetica Neue",Helvetica,Arial,"Lucida Grande",sans-serif; margin: 0; padding: 0;}
a { text-decoration:none;  font-family:"Noto Sans",HelveticaNeue-Light,"Helvetica Neue Light","Helvetica Neue",Helvetica,Arial,"Lucida Grande",sans-serif;margin:0;padding:0;}
a:link, a:visited { text-decoration:none; color: #05109B;}
a:hover {text-decoration: underline;}
.b { text-decoration:none;  font-family:"Noto Sans",HelveticaNeue-Light,"Helvetica Neue Light","Helvetica Neue",Helvetica,Arial,"Lucida Grande",sans-serif;margin:0;padding:0;}
#chart-container { width: 100%; height: 55; display: block; position:absolute; bottom:0; top:0; left:0; right:0;  overflow: hidden; }
</style>   
<style>
.col-container {
  display: table;
  width: 100%;
}
.col {
  display: table-cell;
  padding: 0px;
  width:25%;
  text-decoration:none;  font-family:"Noto Sans",HelveticaNeue-Light,"Helvetica Neue Light","Helvetica Neue",Helvetica,Arial,"Lucida Grande",sans-serif;margin:0;padding:0;
}
</style>
     
<div class="col-container">
    <div class="col" >
        <p id="container1" style="height: 200px; width: 200px;position: relative; margin: -25px auto -15 auto;top: 0%;"></p>
        <p id="AffichageTitre1" style="margin: -10 auto 0 auto;top: 0%; text-align:center; color:#05109B;">Qualité de l'air - µg/m³</p>
    </div>
    <div class="col" >
        <p id="container2" style="height: 200px; width: 200px;position: relative;   margin: -15px auto -15 auto;top: 0%;"></p>
        <p id="AffichageTitre2" style="margin: 0 auto 0 auto;top: 0%; text-align:center; color:#05109B;">Qualité de l'air - µg/m³</p>
    </div>
    <div class="col" >
        <p id="container3" style="height: 200px; width: 200px;position: relative;   margin: -15px auto -15 auto;top: 0%;"></p>
        <p id="AffichageTitre3" style="margin: 0 auto 0 auto;top: 0%; text-align:center; color:#05109B;">Qualité de l'air - µg/m³</p>
    </div>
    <div class="col" >
        <p id="container4" style="height: 200px; width: 200px;position: relative;   margin: -15px auto -15 auto;top: 0%;"></p>
        <p id="AffichageTitre4" style="margin: 0 auto 0 auto;top: 0%; text-align:center; color:#05109B;">Qualité de l'air - µg/m³</p>
    </div>
    <div class="col" >
        <p id="container5" style="height: 200px; width: 200px;position: relative;   margin: -15px auto -15 auto;top: 0%;"></p>
        <p id="AffichageTitre5" style="margin: 0 auto 0 auto;top: 0%; text-align:center; color:#05109B;">Qualité de l'air - PM2.5</p>
    </div>
    <div class="col" >
        <p id="container6" style="height: 200px; width: 200px;position: relative;   margin: -15px auto -15 auto;top: 0%;"></p>
        <p id="AffichageTitre6" style="margin: 0 auto 0 auto;top: 0%; text-align:center; color:#05109B;">Qualité de l'air - µg/m³</p>
    </div>
</div>
<div class="col" id="container2" style="height: 200px; width: 200px;position: relative;   margin: -15px auto -15 auto;top: 0%;"></div>




</body>
<script>
     //============================================ Bureau JL / TEST ============================================//
var DeviceWebPage		= 'test';
var DeviceShortId		= 'jDP5ZAlISh55VYYQWYIR6g';
var DeviceKey			= 'huodYngtUDGO58-Q8-VFLw';
var DHT22NodeShortId	= 'jDP5ZAlISh60rN5wWYIR6g';
var DHT22NodeKey		= 'iGW59GU2BO6VKDCptEFNrA';
var MQ135NodeShortId	= 'jDP5ZAlISh7TWX_gWYIR6g';
var MQ135NodeKey		= 'sd6iASTvnDK5_G45gj1EfA';
var SDS011NodeShortId	= 'tGib1WSRvEE5Mp-gYUgR6g';
var SDS011NodeKey		= 'qXlMZEFnR1DTs90DwDRGbQ';
//	Temperature
var t_EndFullBlue		= 18;
var t_StartFullGreen	= 21;
var t_EndFullGreen		= 24;
var t_StartFullYellow	= 27;
var t_EndFullYellow		= 29;
var t_StartFullRed		= 34;
//===================================================================================================//


//===================================================================================================//
//=================================== Common colors parameters ======================================//
//===================================================================================================//

//============================================ Humidity =============================================//
var h_EndFullBlue		= 35;
var h_StartFullGreen	= 45;
var h_EndFullGreen		= 55;
var h_StartFullYellow	= 65;
var h_EndFullYellow		= 75;
var h_StartFullRed		= 85;
//======================================== airquality (CO2) =========================================//
var aqc_EndFullBlue		= 400;
var aqc_StartFullGreen	= 415;
var aqc_EndFullGreen	= 550;
var aqc_StartFullYellow	= 600;
var aqc_EndFullYellow	= 900;
var aqc_StartFullRed	= 1000;
//======================================= airquality (PM2.5) ========================================//
var aq25_EndFullBlue	= -1;
var aq25_StartFullGreen	= 0;
var aq25_EndFullGreen	= 5;
var aq25_StartFullYellow	= 10;
var aq25_EndFullYellow	= 17;
var aq25_StartFullRed	= 25;
//======================================= airquality (PM10) =========================================//
var aq10_EndFullBlue	= -1;
var aq10_StartFullGreen	= 0;
var aq10_EndFullGreen	= 10;
var aq10_StartFullYellow	= 20;
var aq10_EndFullYellow	= 34;
var aq10_StartFullRed	= 50;
//===================================================================================================//
var posmonte = 1;
var tabposmonte1 = [17,1]

var TexteTitre;
var date_last_update;
var totalSeconds;
var TexteDuration;
var data;

//============================================== deviceFind ==================================================//
function deviceFind() {
	$.ajax({
type: "GET",
url: '//api.iotguru.live/device/find/' + DeviceShortId,
dataType: "json",
	beforeSend: function (xhr) {
			var accessToken =  Cookies.get('accessToken');
			if (accessToken) {
				xhr.setRequestHeader('Authorization', 'Bearer ' + accessToken);
			}
},
success: function (data) {
			deviceFindResponse(data);
		},
error: function (xhr) {
			deviceFindError(xhr);
		}
	});
}


function deviceFindError(xhr) {
	TexteTitre = 'Error IoTGuru: Device not found';
	document.getElementById("AffichageTitre").innerHTML = TexteTitre;
}

function deviceFindResponse(data) {

	TexteDuration = fluentDuration (data.lastCheck);
	TexteTitre = "<span style=\"font-size:1.875em; color:red ;\"><a target=\"_top\" href=\"https://am-jl.jimdo.com/";
	TexteTitre += DeviceWebPage;
	TexteTitre += '/\"><strong>';

	TexteTitre += data.description;
	TexteTitre += '</a></strong></span><span class="b"; style=\"font-size:1.125em; color:#05109B;\"> &nbsp; {</span><span class="b"; style=\"font-size:1.125em; color:#05109B;';
	if (totalSeconds >= 3600) {TexteTitre +=  ' background-color:#ff598f;\"> ';}
	if (totalSeconds >= 1200 && totalSeconds < 3600) {TexteTitre +=  ' background-color:#fdb1ca;\"> ';}
	if (totalSeconds >= 300 && totalSeconds < 1200) {TexteTitre += ' background-color:#FFF0F5;\"> ';}
	if (totalSeconds < 300){TexteTitre += ' background-color:white;\"> ';}
	TexteTitre += TexteDuration;
	TexteTitre += ' </span><span style=\"font-size:1.125em; background-color:transparent; color:05109B\">}</span>';
	document.getElementById("AffichageTitre").innerHTML = TexteTitre;

}	

    function fluentDuration(timestamp) {
		totalSeconds = 86400;
        if (!timestamp) {
            return 'n/a';
        }

        totalSeconds = ~~((new Date().getTime() - timestamp) / 1000);
        var days = ~~(totalSeconds / 86400);
        var hours = ~~((totalSeconds % 86400) / 3600);
        var minutes = ~~((totalSeconds % 3600) / 60);
        var seconds = ~~(totalSeconds % 60);

        var message = [];
        if (days > 0) {
            message.push(' ');
            message.push(days);
            message.push(' ');
            if (days > 1) {
                message.push('jours');
            } else {
                message.push('jour');
            }
            message.push(' ');
            message.push(hours);
            message.push(' ');
            if (hours > 1) {
                message.push('heures');
            } else {
                message.push('heure');
            }
        } else if (hours > 0) {
            message.push(' ');
            message.push(hours);
            message.push(' ');
            if (hours > 1) {
                message.push('heures');
            } else {
                message.push('heure');
            }
            message.push(' ');
            message.push(minutes);
            message.push(' ');
            if (minutes > 1) {
                message.push('minutes');
            } else {
                message.push('minute');
            }
        } else {
            message.push(' ');
            message.push(minutes);
            message.push(' ');
            if (minutes > 1) {
                message.push('minutes');
            } else {
                message.push('minute');
            }
            message.push(' ');
            message.push(seconds);
            message.push(' ');
            if (seconds > 1) {
                message.push('secondes');
            } else {
                message.push('seconde');
            }
        }

        return message.join('');
    }
    

function loadDual(unit, val24H, valNow, EndFullBlue, StartFullGreen, EndFullGreen, StartFullYellow, EndFullYellow, StartFullRed) {
    Highcharts.chart('container5', {
        chart: {
            type: 'gauge',
            plotBackgroundColor: null,
            plotBackgroundImage: null,
            plotBorderWidth: 0,
            plotShadow: false
        },
        title: {
            text: undefined
        },
        pane: {
            startAngle: -150,
            endAngle: 150,
            background: [{
                backgroundColor: {
                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                    stops: [
                        [0, '#FFF'],
                        [1, '#333']
                    ]
                },
                borderWidth: 0,
                outerRadius: '109%'
            }, {
                backgroundColor: {
                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                    stops: [
                        [0, '#333'],
                        [1, '#FFF']

                    ]
                },
                borderWidth: 1,
                outerRadius: '107%'
            }, {
            }, {
                backgroundColor: '#DDD',
                borderWidth: 0,
                outerRadius: '105%',
                innerRadius: '103%'
            }]
        },

        yAxis: {
            min: 0,
            max: 30,

            minorTickInterval: 1,
            minorTickWidth: 1,
            minorTickLength: 7,
            minorTickPosition: 'inside',
            minorTickColor: '#666',

            tickInterval: 5,
            tickWidth: 2,
            tickPosition: 'inside',
            tickLength: 10,
            tickColor: '#666',
            labels: {
                step: 1,
                rotation: 'auto'
            },
            title: {
                text: unit,
                style: {
                     fontSize: '14px'    
                },
                y:10
            },
            plotBands: [
            {
                from: -Infinity,
                to: EndFullBlue,
                color: '#b8dfdc'
            }, {
                from: EndFullBlue,
                to: StartFullGreen,
                 color: {
                    linearGradient: { x1: 1, y1:1, x2: 1, y2: 0 },
                    stops: [
                        [0, '#b8dfdc'],
                        [1, '#c4ffa5']
                    ]
                 }
                }, {
                from: StartFullGreen,
                to: EndFullGreen,
                color: '#c4ffa5'
            },{
                from: EndFullGreen,
                to: StartFullYellow,
                 color: {
                    linearGradient: { x1: tabposmonte1[1], y1: tabposmonte1[1], x2: tabposmonte1[1], y2: !tabposmonte1[1] },
                    stops: [
                        [0, '#c4ffa5'],
                        [1, '#fffb82']
                    ]
                 }
            }, {
                from: StartFullYellow,
                to: EndFullYellow,
                color: '#fffb82'
            },{
                from: EndFullYellow,
                to: StartFullRed,
                 color: {
                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                    stops: [
                        [0, '#fffb82'],
                        [1, '#ff2a5d']
                    ]
                 }
            }, {
                from: StartFullRed,
                to: Infinity,
                color: '#ff2a5d'
            }]
        },
         exporting: {
         enabled: false
         },
             credits: {
            enabled: false
        },
        series: [{
        


            dataLabels: {
                        enabled : true,
                        format: '{point.name}',
                        useHTML: true,
                        allowOverlap : true,
                        borderWidth: 0,
                formatter: function () {
                    var kmh = '45.4',
                        mph = Math.round(kmh * 0.621);
                    return '<span style="color:#339">24H: ' + kmh + '</span><br/>' +
                        '<span style="color:#933">' + mph + '</span>';
                }
                
            },
            name: 'PM2.5-24H',
data: JSON.parse("[" + val24H + "]"),
//        data: [9.6],  
  //      name: {'<p style="margin:auto; text-align:center; color:blue;">24H 5.7<br/></p><p style="margin:auto; text-align:center; color:red;">19.8</p>'},
            dial: {
                backgroundColor: 'blue'
            },
            tooltip: {
                valueSuffix: ' µg/m³'
            },
            overshoot: 5
        },{
            name: 'PM2.5',
            data: [4.5],
             dial: {
                backgroundColor: 'red'
             },
             tooltip: {
                    valueSuffix: ' µg/m³'
             }
        }],
  });
}

function loadData()
{
	// variable for the data point
	var p;

	// get the data from IoTGuru

	$.ajax(
	{
		type: "GET",
		url: '//api.iotguru.live/measurement/loadLastFloatValues/' + Node_Choice + '/' + Field_Choice + '/1',
		dataType: "json",
		beforeSend: function (xhr) {
			var accessToken =  Cookies.get('accessToken');
			if (accessToken) {
				xhr.setRequestHeader('Authorization', 'Bearer ' + accessToken);
			}
		},
		success: function (data) {
			lastValuesListResponse(data);
		},
		error: function (xhr) {
			lastValuesListError(xhr);
		}
	});
}

$(document).ready(function () {
     deviceFind();
    //loadSingle('graphTemperature', titleText + ' - ' + DeviceDescription, 'Date et heure', '°C', DHT22NodeShortId, 'temperature', granulation, t_EndFullBlue, t_StartFullGreen, t_EndFullGreen, t_StartFullYellow, t_EndFullYellow, t_StartFullRed);
    //loadSingle('graphHumidity', titleText + ' - ' + DeviceDescription, 'Date et heure', '%', DHT22NodeShortId, 'humidity', granulation, h_EndFullBlue, h_StartFullGreen, h_EndFullGreen, h_StartFullYellow, h_EndFullYellow, h_StartFullRed);
    //loadSingle('graphAirQuality', titleText + ' - ' + DeviceDescription, 'Date et heure', 'PPM', MQ135NodeShortId, 'airquality', granulation, aqc_EndFullBlue, aqc_StartFullGreen, aqc_EndFullGreen, aqc_StartFullYellow, aqc_EndFullYellow, aqc_StartFullRed);
    if (SDS011NodeShortId !== undefined && SDS011NodeShortId !== null)
    {
 //        loadDual('graphAirQualityPM25', titleText + ' - ' + DeviceDescription, 'Date et heure', 'µg/m³', SDS011NodeShortId, 'pm25', granulation, aq25_EndFullBlue, aq25_StartFullGreen, aq25_EndFullGreen, aq25_StartFullYellow, aq25_EndFullYellow, aq25_StartFullRed);
 //        loadDual('graphAirQualityPM10', titleText + ' - ' + DeviceDescription, 'Date et heure', 'µg/m³', SDS011NodeShortId, 'pm10', granulation, aq10_EndFullBlue, aq10_StartFullGreen, aq10_EndFullGreen, aq10_StartFullYellow, aq10_EndFullYellow, aq10_StartFullRed);
        loadDual('µg/m³', '17.5', '2.1', aq25_EndFullBlue, aq25_StartFullGreen, aq25_EndFullGreen, aq25_StartFullYellow, aq25_EndFullYellow, aq25_StartFullRed);
    }
});
</script>
</html>