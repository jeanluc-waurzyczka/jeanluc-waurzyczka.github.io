<html lang="fr-FR";>
<head>
<meta  charset=UTF-8">
</head>
<body>
<div id="chart-container">
<p id="AffichageAlarm" style="text-align:left; color:#ff2222;"></p>
<style type="text/css">
{ background-color: white; height: 100%; margin: 0; padding: 0;}
a { text-decoration:none;}
#chart-container {  display: block; position:absolute; bottom:0; top:0; left:0; right:0; margin: 5px 15px 15px 0; overflow: hidden; }
</style>

<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js'></script>

<script type="text/javascript">


var DaysAlarmDisplay =184;

//=============================== TitreMoulinsart =================================//
var site = "arthur";
var room = "Moulinsart";
var channel_id = 809574;
var api_key = '2WTHUAZL6YMI175Y';

//================================================================================//

var TexteTitre ="vide initial";

var date_last_update;

var MinutesTemp;

var MinutesWorking;

// user's timezone offset
var my_offset = new Date().getTimezoneOffset();

var data;

var TexteTitre1 = " initial titre1 ";

$(document).on('ready', function() {

// check if alarm exists
	TexteTitre += check_last_field1(date_last_update, TexteTitre);
	TexteTitre += TexteTitre1;
	TexteTitre += " retour du last ";
	TexteTitre += date_last_update;
//document.getElementById("AffichageAlarm").innerHTML = TexteTitre;

});


function check_last_field1 (date_last_update, TexteTitre)
{
$.getJSON( 'https://api.thingspeak.com/channels/' + channel_id + '/fields/1/last.json?api_key=' + api_key, function(data) {
	
		TexteTitre += "<span style=\"font-size:0.8em; font-family: Arial, Helvetica, sans-serif;\" >";
		var value = data["field1"];
		if (value !== null)
		{
			date_last_update = new Date(data.created_at);
			var date_last_update_millis = Date.parse (date_last_update);
			var date_today = new Date(Date.now());
			var date_today_millis =  Date.parse (date_today);
			
			if (date_last_update_millis > (date_today - 2678400000))
			{
				TexteTitre += "<strong><br>";
				var options = { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric' };
				TexteTitre += date_last_update.toLocaleDateString('fr-FR',options);
				TexteTitre += " ";  
				TexteTitre += date_last_update.getHours();
				TexteTitre += ":";
				MinutesWorking = date_last_update.getMinutes();
				if (MinutesWorking < 10) {MinutesTemp = '0'; MinutesTemp += MinutesWorking;}
				else {MinutesTemp = MinutesWorking;}
				TexteTitre += MinutesTemp;
				TexteTitre += "</strong><br><br> ";
				TexteTitre += value;
				TexteTitre += "<br>";
			}
			
			
			date_last_update = new Date(data.created_at);
			var date_last_alarm_millis = Date.parse (date_last_update);
			var date_today = new Date(Date.now());
			var date_today_millis =  Date.parse (date_today);
			var date_alarm_limit_millis = date_today_millis - (DaysAlarmDisplay * 86400000);
			var date_alarm_limit = new Date (date_alarm_limit_millis);
			TexteTitre += " test dans 1st ";
			
			
		}	
		TexteTitre += " fin recherche si alarme ";
	TexteTitre1 += "</span></p>";	
 document.getElementById("AffichageAlarm").innerHTML = TexteTitre;
 return TexteTitre;
		

}	);

}
	


</script>
</div>
</body>
</html>