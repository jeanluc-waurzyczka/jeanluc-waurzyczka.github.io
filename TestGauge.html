<html>

	<style type="text/css">
{ background-color: white; height: 100%; margin: 0; padding: 0;}
p.a { text-decoration:none;font-family:"Noto Sans",HelveticaNeue-Light,"Helvetica Neue Light","Helvetica Neue",Helvetica,Arial,"Lucida Grande",sans-serif;margin:0;padding:0;   text-align: center;}
#inner { vertical-align: middle; horizontal-align: middle; display: table-cell;}
#chart-container { width: 100%; height: 55; display: block; position:absolute; bottom:0; top:0; left:0; right:0;  overflow: hidden; }
</style>
<style type="text/css">
body
#container { height: 100%; width: 100%; display: table; }
#inner { vertical-align: middle; horizontal-align: middle; display: table-cell;}
#gauge_div { width: 180px; heigh: 180px; margin: 0 auto; }
</style>
<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js'></script>
<script type='text/javascript' src='https://www.google.com/jsapi'></script>
<script type='text/javascript'>




//=============================== TGaugeCampingCar ====================================//
var channel_id = 901544;
var api_key = 'Z996IH7IT3K2DHQ2';


// name of the gauge
var gauge_name = '°C';
// Color parameters
var redTo = 5;
var yellowTo = 12;

// global variables
var chart, charts, data;

// load the google gauge visualization
google.load('visualization', '1', {packages:['gauge']});
google.setOnLoadCallback(initChart);

// display the data
function displayData(point)
{
	data.setValue(0, 0, gauge_name);
	data.setValue(0, 1, point);
	chart.draw(data, options);
}

// load the data
function loadData()
{
	// variable for the data point
	var p;

	// get the data from IoTGuru

	$.ajax(
{
			type: "GET",
			url: '//api.iotguru.live/measurement/loadLastFloatValues/thlAxICXGNACIl9UZn1Ofg/temperature/1',
			dataType: "json",
			beforeSend: function (xhr)
{
					var accessToken = 'eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiI3YTc4MGNlMC0yNjE4LTExZWEtYjhhZi04YmIzODAxNzRkMGUiLCJleHAiOjE1ODA0MDI3MTgsImVtYWlsIjoiamVhbmx1Y0B3YXVyenljemthLmZyIn0.AT3FkgwU5SYHUhLGhUiZuSt_7g29-GMGsp127g1tdis';
					if (accessToken)
{
							xhr.setRequestHeader('Authorization', 'Bearer ' + accessToken);
					}
			},
			success: function (data)
{
//						displayData(n[1]);
					lastValuesListResponse(data);
			},
			error: function (xhr)
{
					lastValuesListError(xhr);
			}
	});
}




function lastValuesListResponse(data) {
	if (data === undefined || data.length === 0) {
			$("#lastValueList tbody").html('');
			$('<tr>').append(
							$('<td colspan="2">').text('you have no measurements yet')
							).appendTo('#lastValueList tbody');
	} else {
//			$("#lastValueList tbody").html('');
//			data.sort(function (n1, n2) {
//					return n1[0] > n2[0]
//			});
			$.each(data, function (idx, n) {

//					$('<tr>').append(
//									$('<td>').text(fluentDuration(n[0])),
//									$('<td>').text(n[1])
//									).appendTo('#lastValueList tbody');
					displayData(n[1]);
					var Texte = [];
					Texte = ('<p class="a"><span style=\"font-size:1.125em;\">');
					Texte += ('Température</span><br><span style=\"font-size:0.75em;\"> { ');
					Texte += (fluentDuration(n[0]));
					Texte += (' }</span></p>');
						document.getElementById("when_div").innerHTML = Texte;
			});
	}
}

function lastValuesListError(xhr) {
	$("#lastValueList tbody").html('');
	$('<tr>').append(
					$('<td colspan="2">').text('Cannot load your measurements at the moment (error code ' + xhr.status + ')...')
					).appendTo('#lastValueList tbody');
}

    function fluentDuration(timestamp) {
        if (!timestamp) {
            return 'n/a';
        }

        var totalSeconds = ~~((new Date().getTime() - timestamp) / 1000);
        var days = ~~(totalSeconds / 86400);
        var hours = ~~((totalSeconds % 86400) / 3600);
        var minutes = ~~((totalSeconds % 3600) / 60);
        var seconds = ~~(totalSeconds % 60);

        var message = [];
        if (days > 0) {
            message.push(' ');
            message.push(days);
            message.push(' ');
            if (days > 1) {
                message.push('jours');
            } else {
                message.push('jour');
            }
            message.push(' ');
            message.push(hours);
            message.push(' ');
            if (hours > 1) {
                message.push('heures');
            } else {
                message.push('heure');
            }
        } else if (hours > 0) {
            message.push(' ');
            message.push(hours);
            message.push(' ');
            if (hours > 1) {
                message.push('heures');
            } else {
                message.push('heure');
            }
            message.push(' ');
            message.push(minutes);
            message.push(' ');
            if (minutes > 1) {
                message.push('minutes');
            } else {
                message.push('minute');
            }
        } else {
            message.push(' ');
            message.push(minutes);
            message.push(' ');
            if (minutes > 1) {
                message.push('minutes');
            } else {
                message.push('minute');
            }
            message.push(' ');
            message.push(seconds);
            message.push(' ');
            if (seconds > 1) {
                message.push('secondes');
            } else {
                message.push('seconde');
            }
        }

        return message.join('');
    }
// initialize the chart
function initChart()
{
	data = new google.visualization.DataTable();
	data.addColumn('string', 'Label');
	data.addColumn('number', 'Value');
	data.addRows(1);
	chart = new google.visualization.Gauge(document.getElementById('gauge_div'));
	options = {width: 180, height: 180, min: 5, max: 35, redColor: '#ff5b5b', redFrom: 0, redTo: redTo, yellowColor: '#ffd468', yellowFrom: redTo, yellowTo: yellowTo, greenColor: '#c4ffa5', greenFrom: yellowTo, greenTo: 40,minorTicks: 5, majorTicks: [5, 10, 15, 20, 25, 30, 35]};

	loadData();
}


</script>

</head>

<body>
<div id="container">
<div id="inner">
<div id="gauge_div"></div>
<div id="when_div"> Test Gauge3</div>
</div>
</div>
</body>
</html>
